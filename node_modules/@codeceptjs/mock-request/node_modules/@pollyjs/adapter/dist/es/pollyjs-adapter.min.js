import{assert as t,getFactoryId as e,PollyError as r,MODES as n,ACTIONS as o,EXPIRY_STRATEGIES as i,Serializers as s}from"@pollyjs/utils";function u(t,e){return t(e={exports:{}},e.exports),e.exports}var a=u(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),c=(a.version,a.JSON||(a.JSON={stringify:JSON.stringify})),f=function(t){return c.stringify.apply(c,arguments)},l={}.toString,p=function(t){return l.call(t).slice(8,-1)},h=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==p(t)?t.split(""):Object(t)},y=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},d=function(t){return h(y(t))},g={f:{}.propertyIsEnumerable},b=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},m=function(t){return"object"==typeof t?null!==t:"function"==typeof t},v=function(t,e){if(!m(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!m(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!m(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!m(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},w={}.hasOwnProperty,O=function(t,e){return w.call(t,e)},S=function(t){try{return!!t()}catch(t){return!0}},R=!S(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),P=u(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),j=P.document,E=m(j)&&m(j.createElement),_=function(t){return E?j.createElement(t):{}},F=!R&&!S(function(){return 7!=Object.defineProperty(_("div"),"a",{get:function(){return 7}}).a}),q=Object.getOwnPropertyDescriptor,N={f:R?q:function(t,e){if(t=d(t),e=v(e,!0),F)try{return q(t,e)}catch(t){}if(O(t,e))return b(!g.f.call(t,e),t[e])}},T=function(t,e,r){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},k=function(t){if(!m(t))throw TypeError(t+" is not an object!");return t},x=Object.defineProperty,I={f:R?Object.defineProperty:function(t,e,r){if(k(t),e=v(e,!0),k(r),F)try{return x(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},D=R?function(t,e,r){return I.f(t,e,b(1,r))}:function(t,e,r){return t[e]=r,t},C=function(t,e,r){var n,o,i,s=t&C.F,u=t&C.G,c=t&C.S,f=t&C.P,l=t&C.B,p=t&C.W,h=u?a:a[e]||(a[e]={}),y=h.prototype,d=u?P:c?P[e]:(P[e]||{}).prototype;for(n in u&&(r=e),r)(o=!s&&d&&void 0!==d[n])&&O(h,n)||(i=o?d[n]:r[n],h[n]=u&&"function"!=typeof d[n]?r[n]:l&&o?T(i,P):p&&d[n]==i?function(t){var e=function(e,r,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,n)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):f&&"function"==typeof i?T(Function.call,i):i,f&&((h.virtual||(h.virtual={}))[n]=i,t&C.R&&y&&!y[n]&&D(y,n,i)))};C.F=1,C.G=2,C.S=4,C.P=8,C.B=16,C.W=32,C.U=64,C.R=128;var M=C,A=function(t,e){var r=(a.Object||{})[t]||Object[t],n={};n[t]=e(r),M(M.S+M.F*S(function(){r(1)}),"Object",n)},J=N.f;A("getOwnPropertyDescriptor",function(){return function(t,e){return J(d(t),e)}});var W,$=a.Object,z=function(t,e){return $.getOwnPropertyDescriptor(t,e)},G=D,B=0,K=Math.random(),Y=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++B+K).toString(36))},H=u(function(t){var e=Y("meta"),r=I.f,n=0,o=Object.isExtensible||function(){return!0},i=!S(function(){return o(Object.preventExtensions({}))}),s=function(t){r(t,e,{value:{i:"O"+ ++n,w:{}}})},u=t.exports={KEY:e,NEED:!1,fastKey:function(t,r){if(!m(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!O(t,e)){if(!o(t))return"F";if(!r)return"E";s(t)}return t[e].i},getWeak:function(t,r){if(!O(t,e)){if(!o(t))return!0;if(!r)return!1;s(t)}return t[e].w},onFreeze:function(t){return i&&u.NEED&&o(t)&&!O(t,e)&&s(t),t}}}),L=(H.KEY,H.NEED,H.fastKey,H.getWeak,H.onFreeze,u(function(t){var e=P["__core-js_shared__"]||(P["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:a.version,mode:"pure",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),U=u(function(t){var e=L("wks"),r=P.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:Y)("Symbol."+t))}).store=e}),Q=I.f,Z=U("toStringTag"),V=function(t,e,r){t&&!O(t=r?t:t.prototype,Z)&&Q(t,Z,{configurable:!0,value:e})},X={f:U},tt=I.f,et=function(t){var e=a.Symbol||(a.Symbol={});"_"==t.charAt(0)||t in e||tt(e,t,{value:X.f(t)})},rt=Math.ceil,nt=Math.floor,ot=function(t){return isNaN(t=+t)?0:(t>0?nt:rt)(t)},it=Math.min,st=Math.max,ut=Math.min,at=L("keys"),ct=function(t){return at[t]||(at[t]=Y(t))},ft=(W=!1,function(t,e,r){var n,o,i=d(t),s=(n=i.length)>0?it(ot(n),9007199254740991):0,u=function(t,e){return(t=ot(t))<0?st(t+e,0):ut(t,e)}(r,s);if(W&&e!=e){for(;s>u;)if((o=i[u++])!=o)return!0}else for(;s>u;u++)if((W||u in i)&&i[u]===e)return W||u||0;return!W&&-1}),lt=ct("IE_PROTO"),pt=function(t,e){var r,n=d(t),o=0,i=[];for(r in n)r!=lt&&O(n,r)&&i.push(r);for(;e.length>o;)O(n,r=e[o++])&&(~ft(i,r)||i.push(r));return i},ht="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),yt=Object.keys||function(t){return pt(t,ht)},dt={f:Object.getOwnPropertySymbols},gt=Array.isArray||function(t){return"Array"==p(t)},bt=function(t){return Object(y(t))},mt=R?Object.defineProperties:function(t,e){k(t);for(var r,n=yt(e),o=n.length,i=0;o>i;)I.f(t,r=n[i++],e[r]);return t},vt=P.document,wt=vt&&vt.documentElement,Ot=ct("IE_PROTO"),St=function(){},Rt=function(){var t,e=_("iframe"),r=ht.length;for(e.style.display="none",wt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Rt=t.F;r--;)delete Rt.prototype[ht[r]];return Rt()},Pt=Object.create||function(t,e){var r;return null!==t?(St.prototype=k(t),r=new St,St.prototype=null,r[Ot]=t):r=Rt(),void 0===e?r:mt(r,e)},jt=ht.concat("length","prototype"),Et={f:Object.getOwnPropertyNames||function(t){return pt(t,jt)}},_t=Et.f,Ft={}.toString,qt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Nt={f:function(t){return qt&&"[object Window]"==Ft.call(t)?function(t){try{return _t(t)}catch(t){return qt.slice()}}(t):_t(d(t))}},Tt=H.KEY,kt=N.f,xt=I.f,It=Nt.f,Dt=P.Symbol,Ct=P.JSON,Mt=Ct&&Ct.stringify,At=U("_hidden"),Jt=U("toPrimitive"),Wt={}.propertyIsEnumerable,$t=L("symbol-registry"),zt=L("symbols"),Gt=L("op-symbols"),Bt=Object.prototype,Kt="function"==typeof Dt&&!!dt.f,Yt=P.QObject,Ht=!Yt||!Yt.prototype||!Yt.prototype.findChild,Lt=R&&S(function(){return 7!=Pt(xt({},"a",{get:function(){return xt(this,"a",{value:7}).a}})).a})?function(t,e,r){var n=kt(Bt,e);n&&delete Bt[e],xt(t,e,r),n&&t!==Bt&&xt(Bt,e,n)}:xt,Ut=function(t){var e=zt[t]=Pt(Dt.prototype);return e._k=t,e},Qt=Kt&&"symbol"==typeof Dt.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof Dt},Zt=function(t,e,r){return t===Bt&&Zt(Gt,e,r),k(t),e=v(e,!0),k(r),O(zt,e)?(r.enumerable?(O(t,At)&&t[At][e]&&(t[At][e]=!1),r=Pt(r,{enumerable:b(0,!1)})):(O(t,At)||xt(t,At,b(1,{})),t[At][e]=!0),Lt(t,e,r)):xt(t,e,r)},Vt=function(t,e){k(t);for(var r,n=function(t){var e=yt(t),r=dt.f;if(r)for(var n,o=r(t),i=g.f,s=0;o.length>s;)i.call(t,n=o[s++])&&e.push(n);return e}(e=d(e)),o=0,i=n.length;i>o;)Zt(t,r=n[o++],e[r]);return t},Xt=function(t){var e=Wt.call(this,t=v(t,!0));return!(this===Bt&&O(zt,t)&&!O(Gt,t))&&(!(e||!O(this,t)||!O(zt,t)||O(this,At)&&this[At][t])||e)},te=function(t,e){if(t=d(t),e=v(e,!0),t!==Bt||!O(zt,e)||O(Gt,e)){var r=kt(t,e);return!r||!O(zt,e)||O(t,At)&&t[At][e]||(r.enumerable=!0),r}},ee=function(t){for(var e,r=It(d(t)),n=[],o=0;r.length>o;)O(zt,e=r[o++])||e==At||e==Tt||n.push(e);return n},re=function(t){for(var e,r=t===Bt,n=It(r?Gt:d(t)),o=[],i=0;n.length>i;)!O(zt,e=n[i++])||r&&!O(Bt,e)||o.push(zt[e]);return o};Kt||(G((Dt=function(){if(this instanceof Dt)throw TypeError("Symbol is not a constructor!");var t=Y(arguments.length>0?arguments[0]:void 0),e=function(r){this===Bt&&e.call(Gt,r),O(this,At)&&O(this[At],t)&&(this[At][t]=!1),Lt(this,t,b(1,r))};return R&&Ht&&Lt(Bt,t,{configurable:!0,set:e}),Ut(t)}).prototype,"toString",function(){return this._k}),N.f=te,I.f=Zt,Et.f=Nt.f=ee,g.f=Xt,dt.f=re,X.f=function(t){return Ut(U(t))}),M(M.G+M.W+M.F*!Kt,{Symbol:Dt});for(var ne="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),oe=0;ne.length>oe;)U(ne[oe++]);for(var ie=yt(U.store),se=0;ie.length>se;)et(ie[se++]);M(M.S+M.F*!Kt,"Symbol",{for:function(t){return O($t,t+="")?$t[t]:$t[t]=Dt(t)},keyFor:function(t){if(!Qt(t))throw TypeError(t+" is not a symbol!");for(var e in $t)if($t[e]===t)return e},useSetter:function(){Ht=!0},useSimple:function(){Ht=!1}}),M(M.S+M.F*!Kt,"Object",{create:function(t,e){return void 0===e?Pt(t):Vt(Pt(t),e)},defineProperty:Zt,defineProperties:Vt,getOwnPropertyDescriptor:te,getOwnPropertyNames:ee,getOwnPropertySymbols:re});var ue=S(function(){dt.f(1)});M(M.S+M.F*ue,"Object",{getOwnPropertySymbols:function(t){return dt.f(bt(t))}}),Ct&&M(M.S+M.F*(!Kt||S(function(){var t=Dt();return"[null]"!=Mt([t])||"{}"!=Mt({a:t})||"{}"!=Mt(Object(t))})),"JSON",{stringify:function(t){for(var e,r,n=[t],o=1;arguments.length>o;)n.push(arguments[o++]);if(r=e=n[1],(m(e)||void 0!==t)&&!Qt(t))return gt(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Qt(e))return e}),n[1]=e,Mt.apply(Ct,n)}}),Dt.prototype[Jt]||D(Dt.prototype,Jt,Dt.prototype.valueOf),V(Dt,"Symbol"),V(Math,"Math",!0),V(P.JSON,"JSON",!0);var ae=a.Object.getOwnPropertySymbols;A("keys",function(){return function(t){return yt(bt(t))}});var ce=a.Object.keys;M(M.S+M.F*!R,"Object",{defineProperty:I.f});var fe=a.Object,le=function(t,e,r){return fe.defineProperty(t,e,r)};var pe=function(t,e,r){return e in t?le(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var he,ye=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=ce(r);"function"==typeof ae&&(n=n.concat(ae(r).filter(function(t){return z(r,t).enumerable}))),n.forEach(function(e){pe(t,e,r[e])})}return t},de=Object.freeze({});et("asyncIterator"),et("observable"),(he=de)&&he.default;var ge=a.Symbol,be="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",me="["+be+"]",ve=RegExp("^"+me+me+"*"),we=RegExp(me+me+"*$"),Oe=function(t,e,r){var n={},o=S(function(){return!!be[t]()||"​"!="​"[t]()}),i=n[t]=o?e(Se):be[t];r&&(n[r]=i),M(M.P+M.F*o,"String",n)},Se=Oe.trim=function(t,e){return t=String(y(t)),1&e&&(t=t.replace(ve,"")),2&e&&(t=t.replace(we,"")),t},Re=Oe,Pe=P.parseFloat,je=Re.trim,Ee=1/Pe(be+"-0")!=-1/0?function(t){var e=je(String(t),3),r=Pe(e);return 0===r&&"-"==e.charAt(0)?-0:r}:Pe;M(M.G+M.F*(parseFloat!=Ee),{parseFloat:Ee});var _e=a.parseFloat;const Fe=/([0-9.]+)([a-zA-Z]+)/g,qe={ms:1,millisecond:1,milliseconds:1,s:1e3,sec:1e3,secs:1e3,second:1e3,seconds:1e3,m:6e4,min:6e4,mins:6e4,minute:6e4,minutes:6e4,h:36e5,hr:36e5,hrs:36e5,hour:36e5,hours:36e5,d:864e5,day:864e5,days:864e5,w:6048e5,wk:6048e5,wks:6048e5,week:6048e5,weeks:6048e5,y:31536e6,yr:31536e6,yrs:31536e6,year:31536e6,years:31536e6};function Ne(t,e){return!(!t||!e)&&new Date>new Date(new Date(t).getTime()+("string"!=typeof(r=e)?NaN:r.replace(/ /g,"").match(Fe).map(t=>t.split(Fe).filter(t=>t)).reduce((t,[e,r])=>t+_e(e)*qe[r],0)));var r}function Te(t,...e){const r=ye({},t.config);return["adapter","adapterOptions","persister","persisterOptions"].forEach(t=>delete r[t]),f({url:t.url,method:t.method,headers:t.headers,body:t.body,recordingName:t.recordingName,id:t.id,order:t.order,identifiers:t.identifiers,config:r},...e)}const{isArray:ke}=Array;function xe(t){return(t||[]).reduce((t,{name:e,value:r,_fromType:n})=>{const o=t[e];return o?(ke(o)||(t[e]=[o]),t[e].push(r)):t[e]="array"===n?[r]:r,t},{})}const Ie=ge();export default class{constructor(t){this.polly=t,this.isConnected=!1}static get type(){return"adapter"}static get id(){t("Must override the static `id` getter.")}get defaultOptions(){return{}}get options(){return ye({},this.defaultOptions||{},(this.polly.config.adapterOptions||{})[e(this.constructor)]||{})}get persister(){return this.polly.persister}connect(){this.isConnected||(this.onConnect(),this.isConnected=!0)}disconnect(){this.isConnected&&(this.onDisconnect(),this.isConnected=!1)}timeout(t,{time:e}){const{timing:r}=t.config;if("function"==typeof r)return r(e)}async handleRequest(t){const e=this.polly.registerRequest(t);try{if(e.on("identify",(...t)=>this.onIdentifyRequest(...t)),await this.onRequest(e),await e.init(),await this[Ie](e),e.aborted)throw new r("Request aborted.");await this.onRequestFinished(e)}catch(t){await this.onRequestFailed(e,t)}return e}async[Ie](t){const{mode:e}=this.polly,{_interceptor:r}=t;if(!(t.aborted||t.shouldIntercept&&(await this.intercept(t,r),r.shouldIntercept)))return e===n.PASSTHROUGH||t.shouldPassthrough||r.shouldPassthrough?this.passthrough(t):(this.assert("A persister must be configured in order to record and replay requests.",!!this.persister),e===n.RECORD?this.record(t):e===n.REPLAY?this.replay(t):void this.assert("Unhandled request: \n"+Te(t,null,2)))}async passthrough(t){return t.action=o.PASSTHROUGH,this.onPassthrough(t)}async intercept(t,e){if(t.action=o.INTERCEPT,await t._intercept(e),e.shouldIntercept)return this.onIntercept(t,t.response)}async record(t){return t.action=o.RECORD,"navigator"in global&&!navigator.onLine&&console.warn("[Polly] Recording may fail because the browser is offline.\n"+`${Te(t)}`),this.onRecord(t)}async replay(t){const{config:e}=t,r=await this.persister.findEntry(t);if(r){const n=JSON.parse(f(r));if(await t._emit("beforeReplay",n),Ne(n.startedDateTime,e.expiresIn)){const r="Recording for the following request has expired.\n"+`${Te(t,null,2)}`;switch(e.expiryStrategy){case i.RECORD:return this.record(t);case i.ERROR:this.assert(r);break;case i.WARN:console.warn(`[Polly] ${r}`);break;default:this.assert(`Invalid config option passed for "expiryStrategy": "${e.expiryStrategy}"`)}}return await this.timeout(t,n),t.action=o.REPLAY,this.onReplay(t,function(t){const{status:e,statusText:r,headers:n,content:o}=t;return{statusText:r,statusCode:e,headers:xe(n),body:o&&o.text,isBinary:Boolean(o&&o._isBinary)}}(n.response),n)}if(e.recordIfMissing)return this.record(t);this.assert("Recording for the following request is not found and `recordIfMissing` is `false`.\n"+Te(t,null,2))}assert(r,...n){t(`[${this.constructor.type}:${e(this.constructor)}] ${r}`,...n)}onConnect(){this.assert("Must implement the `onConnect` hook.")}onDisconnect(){this.assert("Must implement the `onDisconnect` hook.")}async passthroughRequest(){this.assert("Must implement the `passthroughRequest` hook.")}async respondToRequest(){}async onRecord(t){await this.onPassthrough(t),t.aborted||await this.persister.recordRequest(t)}async onReplay(t,e){await t.respond(e)}async onIntercept(t,e){await t.respond(e)}async onPassthrough(t){const e=await this.passthroughRequest(t);await t.respond(e)}async onIdentifyRequest(t){const{identifiers:e}=t;for(const t of["blob","formData","buffer"])e.body=await s[t](e.body)}onRequest(){}async onRequestFinished(t){await this.respondToRequest(t),t.promise.resolve()}async onRequestFailed(t,e){const{aborted:n}=t;e=e||new r("Request failed due to an unknown error.");try{n?await t._emit("abort"):await t._emit("error",e),await this.respondToRequest(t,e)}catch(t){throw t}finally{t.promise.reject(e)}}}
//# sourceMappingURL=pollyjs-adapter.min.js.map
