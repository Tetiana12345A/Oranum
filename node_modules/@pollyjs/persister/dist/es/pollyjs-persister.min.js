import t from"fast-json-stable-stringify";import{assert as e,getFactoryId as n,ACTIONS as r}from"@pollyjs/utils";import o from"bowser";import i from"utf8-byte-length";import s from"set-cookie-parser";var c=Object.freeze({}),u=Math.ceil,a=Math.floor,f=function(t){return isNaN(t=+t)?0:(t>0?a:u)(t)},l=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t};function h(t,e){return t(e={exports:{}},e.exports),e.exports}var p=h(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),v=h(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),d=(v.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),y=function(t,e,n){if(d(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},g=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_=function(t){if(!g(t))throw TypeError(t+" is not an object!");return t},m=function(t){try{return!!t()}catch(t){return!0}},b=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),w=p.document,O=g(w)&&g(w.createElement),S=function(t){return O?w.createElement(t):{}},j=!b&&!m(function(){return 7!=Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a}),P=function(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},E=Object.defineProperty,T={f:b?Object.defineProperty:function(t,e,n){if(_(t),e=P(e,!0),_(n),j)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},k=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},x=b?function(t,e,n){return T.f(t,e,k(1,n))}:function(t,e,n){return t[e]=n,t},M={}.hasOwnProperty,R=function(t,e){return M.call(t,e)},F=function(t,e,n){var r,o,i,s=t&F.F,c=t&F.G,u=t&F.S,a=t&F.P,f=t&F.B,l=t&F.W,h=c?v:v[e]||(v[e]={}),d=h.prototype,g=c?p:u?p[e]:(p[e]||{}).prototype;for(r in c&&(n=e),n)(o=!s&&g&&void 0!==g[r])&&R(h,r)||(i=o?g[r]:n[r],h[r]=c&&"function"!=typeof g[r]?n[r]:f&&o?y(i,p):l&&g[r]==i?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):a&&"function"==typeof i?y(Function.call,i):i,a&&((h.virtual||(h.virtual={}))[r]=i,t&F.R&&d&&!d[r]&&x(d,r,i)))};F.F=1,F.G=2,F.S=4,F.P=8,F.B=16,F.W=32,F.U=64,F.R=128;var A,L=F,C=x,z={},N={}.toString,D=function(t){return N.call(t).slice(8,-1)},I=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==D(t)?t.split(""):Object(t)},q=function(t){return I(l(t))},$=Math.min,G=function(t){return t>0?$(f(t),9007199254740991):0},H=Math.max,U=Math.min,V=h(function(t){var e=p["__core-js_shared__"]||(p["__core-js_shared__"]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:v.version,mode:"pure",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),W=0,B=Math.random(),J=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++W+B).toString(36))},K=V("keys"),Y=function(t){return K[t]||(K[t]=J(t))},Q=(A=!1,function(t,e,n){var r,o=q(t),i=G(o.length),s=function(t,e){return(t=f(t))<0?H(t+e,0):U(t,e)}(n,i);if(A&&e!=e){for(;i>s;)if((r=o[s++])!=r)return!0}else for(;i>s;s++)if((A||s in o)&&o[s]===e)return A||s||0;return!A&&-1}),X=Y("IE_PROTO"),Z=function(t,e){var n,r=q(t),o=0,i=[];for(n in r)n!=X&&R(r,n)&&i.push(n);for(;e.length>o;)R(r,n=e[o++])&&(~Q(i,n)||i.push(n));return i},tt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),et=Object.keys||function(t){return Z(t,tt)},nt=b?Object.defineProperties:function(t,e){_(t);for(var n,r=et(e),o=r.length,i=0;o>i;)T.f(t,n=r[i++],e[n]);return t},rt=p.document,ot=rt&&rt.documentElement,it=Y("IE_PROTO"),st=function(){},ct=function(){var t,e=S("iframe"),n=tt.length;for(e.style.display="none",ot.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ct=t.F;n--;)delete ct.prototype[tt[n]];return ct()},ut=Object.create||function(t,e){var n;return null!==t?(st.prototype=_(t),n=new st,st.prototype=null,n[it]=t):n=ct(),void 0===e?n:nt(n,e)},at=h(function(t){var e=V("wks"),n=p.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:J)("Symbol."+t))}).store=e}),ft=T.f,lt=at("toStringTag"),ht=function(t,e,n){t&&!R(t=n?t:t.prototype,lt)&&ft(t,lt,{configurable:!0,value:e})},pt={};x(pt,at("iterator"),function(){return this});var vt,dt=function(t,e,n){t.prototype=ut(pt,{next:k(1,n)}),ht(t,e+" Iterator")},yt=function(t){return Object(l(t))},gt=Y("IE_PROTO"),_t=Object.prototype,mt=Object.getPrototypeOf||function(t){return t=yt(t),R(t,gt)?t[gt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?_t:null},bt=at("iterator"),wt=!([].keys&&"next"in[].keys()),Ot=function(){return this},St=function(t,e,n,r,o,i,s){dt(n,e,r);var c,u,a,f=function(t){if(!wt&&t in v)return v[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},l=e+" Iterator",h="values"==o,p=!1,v=t.prototype,d=v[bt]||v["@@iterator"]||o&&v[o],y=d||f(o),g=o?h?f("entries"):y:void 0,_="Array"==e&&v.entries||d;if(_&&(a=mt(_.call(new t)))!==Object.prototype&&a.next&&ht(a,l,!0),h&&d&&"values"!==d.name&&(p=!0,y=function(){return d.call(this)}),s&&(wt||p||!v[bt])&&x(v,bt,y),z[e]=y,z[l]=Ot,o)if(c={values:h?y:f("values"),keys:i?y:f("keys"),entries:g},s)for(u in c)u in v||C(v,u,c[u]);else L(L.P+L.F*(wt||p),e,c);return c},jt=(vt=!0,function(t,e){var n,r,o=String(l(t)),i=f(e),s=o.length;return i<0||i>=s?vt?"":void 0:(n=o.charCodeAt(i))<55296||n>56319||i+1===s||(r=o.charCodeAt(i+1))<56320||r>57343?vt?o.charAt(i):n:vt?o.slice(i,i+2):r-56320+(n-55296<<10)+65536});St(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=jt(e,n),this._i+=t.length,{value:t,done:!1})});var Pt=function(t,e){return{value:e,done:!!t}};St(Array,"Array",function(t,e){this._t=q(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Pt(1)):Pt(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");z.Arguments=z.Array;for(var Et=at("toStringTag"),Tt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),kt=0;kt<Tt.length;kt++){var xt=Tt[kt],Mt=p[xt],Rt=Mt&&Mt.prototype;Rt&&!Rt[Et]&&x(Rt,Et,xt),z[xt]=z.Array}var Ft,At,Lt,Ct=at("toStringTag"),zt="Arguments"==D(function(){return arguments}()),Nt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ct))?n:zt?D(e):"Object"==(r=D(e))&&"function"==typeof e.callee?"Arguments":r},Dt=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},It=function(t,e,n,r){try{return r?e(_(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&_(o.call(t)),e}},qt=at("iterator"),$t=Array.prototype,Gt=at("iterator"),Ht=v.getIteratorMethod=function(t){if(null!=t)return t[Gt]||t["@@iterator"]||z[Nt(t)]},Ut=h(function(t){var e={},n={},r=t.exports=function(t,r,o,i,s){var c,u,a,f,l,h=s?function(){return t}:Ht(t),p=y(o,i,r?2:1),v=0;if("function"!=typeof h)throw TypeError(t+" is not iterable!");if(void 0===(l=h)||z.Array!==l&&$t[qt]!==l){for(a=h.call(t);!(u=a.next()).done;)if((f=It(a,p,u.value,r))===e||f===n)return f}else for(c=G(t.length);c>v;v++)if((f=r?p(_(u=t[v])[0],u[1]):p(t[v]))===e||f===n)return f};r.BREAK=e,r.RETURN=n}),Vt=at("species"),Wt=function(t,e){var n,r=_(t).constructor;return void 0===r||null==(n=_(r)[Vt])?e:d(n)},Bt=p.process,Jt=p.setImmediate,Kt=p.clearImmediate,Yt=p.MessageChannel,Qt=p.Dispatch,Xt=0,Zt={},te=function(){var t=+this;if(Zt.hasOwnProperty(t)){var e=Zt[t];delete Zt[t],e()}},ee=function(t){te.call(t.data)};Jt&&Kt||(Jt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Zt[++Xt]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Ft(Xt),Xt},Kt=function(t){delete Zt[t]},"process"==D(Bt)?Ft=function(t){Bt.nextTick(y(te,t,1))}:Qt&&Qt.now?Ft=function(t){Qt.now(y(te,t,1))}:Yt?(Lt=(At=new Yt).port2,At.port1.onmessage=ee,Ft=y(Lt.postMessage,Lt,1)):p.addEventListener&&"function"==typeof postMessage&&!p.importScripts?(Ft=function(t){p.postMessage(t+"","*")},p.addEventListener("message",ee,!1)):Ft="onreadystatechange"in S("script")?function(t){ot.appendChild(S("script")).onreadystatechange=function(){ot.removeChild(this),te.call(t)}}:function(t){setTimeout(y(te,t,1),0)});var ne={set:Jt,clear:Kt},re=ne.set,oe=p.MutationObserver||p.WebKitMutationObserver,ie=p.process,se=p.Promise,ce="process"==D(ie);function ue(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=d(e),this.reject=d(n)}var ae={f:function(t){return new ue(t)}},fe=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},le=p.navigator,he=le&&le.userAgent||"",pe=function(t,e){if(_(t),g(e)&&e.constructor===t)return e;var n=ae.f(t);return(0,n.resolve)(e),n.promise},ve=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:x(t,r,e[r]);return t},de=at("species"),ye=function(t){var e="function"==typeof v[t]?v[t]:p[t];b&&e&&!e[de]&&T.f(e,de,{configurable:!0,get:function(){return this}})},ge=at("iterator"),_e=!1;try{var me=[7][ge]();me.return=function(){_e=!0},Array.from(me,function(){throw 2})}catch(t){}var be,we,Oe,Se,je,Pe=ne.set,Ee=function(){var t,e,n,r=function(){var r,o;for(ce&&(r=ie.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(ce)n=function(){ie.nextTick(r)};else if(!oe||p.navigator&&p.navigator.standalone)if(se&&se.resolve){var o=se.resolve(void 0);n=function(){o.then(r)}}else n=function(){re.call(p,r)};else{var i=!0,s=document.createTextNode("");new oe(r).observe(s,{characterData:!0}),n=function(){s.data=i=!i}}return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),Te=p.TypeError,ke=p.process,xe=ke&&ke.versions,Me=xe&&xe.v8||"",Re=p.Promise,Fe="process"==Nt(ke),Ae=function(){},Le=we=ae.f,Ce=!!function(){try{var t=Re.resolve(1),e=(t.constructor={})[at("species")]=function(t){t(Ae,Ae)};return(Fe||"function"==typeof PromiseRejectionEvent)&&t.then(Ae)instanceof e&&0!==Me.indexOf("6.6")&&-1===he.indexOf("Chrome/66")}catch(t){}}(),ze=function(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e},Ne=function(t,e){if(!t._n){t._n=!0;var n=t._c;Ee(function(){for(var r=t._v,o=1==t._s,i=0,s=function(e){var n,i,s,c=o?e.ok:e.fail,u=e.resolve,a=e.reject,f=e.domain;try{c?(o||(2==t._h&&qe(t),t._h=1),!0===c?n=r:(f&&f.enter(),n=c(r),f&&(f.exit(),s=!0)),n===e.promise?a(Te("Promise-chain cycle")):(i=ze(n))?i.call(n,u,a):u(n)):a(r)}catch(t){f&&!s&&f.exit(),a(t)}};n.length>i;)s(n[i++]);t._c=[],t._n=!1,e&&!t._h&&De(t)})}},De=function(t){Pe.call(p,function(){var e,n,r,o=t._v,i=Ie(t);if(i&&(e=fe(function(){Fe?ke.emit("unhandledRejection",o,t):(n=p.onunhandledrejection)?n({promise:t,reason:o}):(r=p.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=Fe||Ie(t)?2:1),t._a=void 0,i&&e.e)throw e.v})},Ie=function(t){return 1!==t._h&&0===(t._a||t._c).length},qe=function(t){Pe.call(p,function(){var e;Fe?ke.emit("rejectionHandled",t):(e=p.onrejectionhandled)&&e({promise:t,reason:t._v})})},$e=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ne(e,!0))},Ge=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw Te("Promise can't be resolved itself");(e=ze(t))?Ee(function(){var r={_w:n,_d:!1};try{e.call(t,y(Ge,r,1),y($e,r,1))}catch(t){$e.call(r,t)}}):(n._v=t,n._s=1,Ne(n,!1))}catch(t){$e.call({_w:n,_d:!1},t)}}};Ce||(Re=function(t){Dt(this,Re,"Promise","_h"),d(t),be.call(this);try{t(y(Ge,this,1),y($e,this,1))}catch(t){$e.call(this,t)}},(be=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=ve(Re.prototype,{then:function(t,e){var n=Le(Wt(this,Re));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Fe?ke.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ne(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Oe=function(){var t=new be;this.promise=t,this.resolve=y(Ge,t,1),this.reject=y($e,t,1)},ae.f=Le=function(t){return t===Re||t===Se?new Oe(t):we(t)}),L(L.G+L.W+L.F*!Ce,{Promise:Re}),ht(Re,"Promise"),ye("Promise"),Se=v.Promise,L(L.S+L.F*!Ce,"Promise",{reject:function(t){var e=Le(this);return(0,e.reject)(t),e.promise}}),L(L.S+!0*L.F,"Promise",{resolve:function(t){return pe(this===Se?Re:this,t)}}),L(L.S+L.F*!(Ce&&function(t,e){if(!e&&!_e)return!1;var n=!1;try{var r=[7],o=r[ge]();o.next=function(){return{done:n=!0}},r[ge]=function(){return o},t(r)}catch(t){}return n}(function(t){Re.all(t).catch(Ae)})),"Promise",{all:function(t){var e=this,n=Le(e),r=n.resolve,o=n.reject,i=fe(function(){var n=[],i=0,s=1;Ut(t,!1,function(t){var c=i++,u=!1;n.push(void 0),s++,e.resolve(t).then(function(t){u||(u=!0,n[c]=t,--s||r(n))},o)}),--s||r(n)});return i.e&&o(i.v),n.promise},race:function(t){var e=this,n=Le(e),r=n.reject,o=fe(function(){Ut(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}}),L(L.P+L.R,"Promise",{finally:function(t){var e=Wt(this,v.Promise||p.Promise),n="function"==typeof t;return this.then(n?function(n){return pe(e,t()).then(function(){return n})}:t,n?function(n){return pe(e,t()).then(function(){throw n})}:t)}}),L(L.S,"Promise",{try:function(t){var e=ae.f(this),n=fe(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}}),(je=c)&&je.default;var He=v.Promise,Ue={f:{}.propertyIsEnumerable},Ve=Object.getOwnPropertyDescriptor,We={f:b?Ve:function(t,e){if(t=q(t),e=P(e,!0),j)try{return Ve(t,e)}catch(t){}if(R(t,e))return k(!Ue.f.call(t,e),t[e])}},Be=function(t,e){var n=(v.Object||{})[t]||Object[t],r={};r[t]=e(n),L(L.S+L.F*m(function(){n(1)}),"Object",r)},Je=We.f;Be("getOwnPropertyDescriptor",function(){return function(t,e){return Je(q(t),e)}});var Ke=v.Object,Ye=function(t,e){return Ke.getOwnPropertyDescriptor(t,e)},Qe=h(function(t){var e=J("meta"),n=T.f,r=0,o=Object.isExtensible||function(){return!0},i=!m(function(){return o(Object.preventExtensions({}))}),s=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},c=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!g(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!R(t,e)){if(!o(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!R(t,e)){if(!o(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return i&&c.NEED&&o(t)&&!R(t,e)&&s(t),t}}}),Xe=(Qe.KEY,Qe.NEED,Qe.fastKey,Qe.getWeak,Qe.onFreeze,{f:at}),Ze=T.f,tn=function(t){var e=v.Symbol||(v.Symbol={});"_"==t.charAt(0)||t in e||Ze(e,t,{value:Xe.f(t)})},en={f:Object.getOwnPropertySymbols},nn=Array.isArray||function(t){return"Array"==D(t)},rn=tt.concat("length","prototype"),on={f:Object.getOwnPropertyNames||function(t){return Z(t,rn)}},sn=on.f,cn={}.toString,un="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],an={f:function(t){return un&&"[object Window]"==cn.call(t)?function(t){try{return sn(t)}catch(t){return un.slice()}}(t):sn(q(t))}},fn=Qe.KEY,ln=We.f,hn=T.f,pn=an.f,vn=p.Symbol,dn=p.JSON,yn=dn&&dn.stringify,gn=at("_hidden"),_n=at("toPrimitive"),mn={}.propertyIsEnumerable,bn=V("symbol-registry"),wn=V("symbols"),On=V("op-symbols"),Sn=Object.prototype,jn="function"==typeof vn&&!!en.f,Pn=p.QObject,En=!Pn||!Pn.prototype||!Pn.prototype.findChild,Tn=b&&m(function(){return 7!=ut(hn({},"a",{get:function(){return hn(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=ln(Sn,e);r&&delete Sn[e],hn(t,e,n),r&&t!==Sn&&hn(Sn,e,r)}:hn,kn=function(t){var e=wn[t]=ut(vn.prototype);return e._k=t,e},xn=jn&&"symbol"==typeof vn.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof vn},Mn=function(t,e,n){return t===Sn&&Mn(On,e,n),_(t),e=P(e,!0),_(n),R(wn,e)?(n.enumerable?(R(t,gn)&&t[gn][e]&&(t[gn][e]=!1),n=ut(n,{enumerable:k(0,!1)})):(R(t,gn)||hn(t,gn,k(1,{})),t[gn][e]=!0),Tn(t,e,n)):hn(t,e,n)},Rn=function(t,e){_(t);for(var n,r=function(t){var e=et(t),n=en.f;if(n)for(var r,o=n(t),i=Ue.f,s=0;o.length>s;)i.call(t,r=o[s++])&&e.push(r);return e}(e=q(e)),o=0,i=r.length;i>o;)Mn(t,n=r[o++],e[n]);return t},Fn=function(t){var e=mn.call(this,t=P(t,!0));return!(this===Sn&&R(wn,t)&&!R(On,t))&&(!(e||!R(this,t)||!R(wn,t)||R(this,gn)&&this[gn][t])||e)},An=function(t,e){if(t=q(t),e=P(e,!0),t!==Sn||!R(wn,e)||R(On,e)){var n=ln(t,e);return!n||!R(wn,e)||R(t,gn)&&t[gn][e]||(n.enumerable=!0),n}},Ln=function(t){for(var e,n=pn(q(t)),r=[],o=0;n.length>o;)R(wn,e=n[o++])||e==gn||e==fn||r.push(e);return r},Cn=function(t){for(var e,n=t===Sn,r=pn(n?On:q(t)),o=[],i=0;r.length>i;)!R(wn,e=r[i++])||n&&!R(Sn,e)||o.push(wn[e]);return o};jn||(C((vn=function(){if(this instanceof vn)throw TypeError("Symbol is not a constructor!");var t=J(arguments.length>0?arguments[0]:void 0),e=function(n){this===Sn&&e.call(On,n),R(this,gn)&&R(this[gn],t)&&(this[gn][t]=!1),Tn(this,t,k(1,n))};return b&&En&&Tn(Sn,t,{configurable:!0,set:e}),kn(t)}).prototype,"toString",function(){return this._k}),We.f=An,T.f=Mn,on.f=an.f=Ln,Ue.f=Fn,en.f=Cn,Xe.f=function(t){return kn(at(t))}),L(L.G+L.W+L.F*!jn,{Symbol:vn});for(var zn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Nn=0;zn.length>Nn;)at(zn[Nn++]);for(var Dn=et(at.store),In=0;Dn.length>In;)tn(Dn[In++]);L(L.S+L.F*!jn,"Symbol",{for:function(t){return R(bn,t+="")?bn[t]:bn[t]=vn(t)},keyFor:function(t){if(!xn(t))throw TypeError(t+" is not a symbol!");for(var e in bn)if(bn[e]===t)return e},useSetter:function(){En=!0},useSimple:function(){En=!1}}),L(L.S+L.F*!jn,"Object",{create:function(t,e){return void 0===e?ut(t):Rn(ut(t),e)},defineProperty:Mn,defineProperties:Rn,getOwnPropertyDescriptor:An,getOwnPropertyNames:Ln,getOwnPropertySymbols:Cn});var qn=m(function(){en.f(1)});L(L.S+L.F*qn,"Object",{getOwnPropertySymbols:function(t){return en.f(yt(t))}}),dn&&L(L.S+L.F*(!jn||m(function(){var t=vn();return"[null]"!=yn([t])||"{}"!=yn({a:t})||"{}"!=yn(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=e=r[1],(g(e)||void 0!==t)&&!xn(t))return nn(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!xn(e))return e}),r[1]=e,yn.apply(dn,r)}}),vn.prototype[_n]||x(vn.prototype,_n,vn.prototype.valueOf),ht(vn,"Symbol"),ht(Math,"Math",!0),ht(p.JSON,"JSON",!0);var $n=v.Object.getOwnPropertySymbols;Be("keys",function(){return function(t){return et(yt(t))}});var Gn=v.Object.keys;L(L.S+L.F*!b,"Object",{defineProperty:T.f});var Hn=v.Object,Un=function(t,e,n){return Hn.defineProperty(t,e,n)};var Vn=function(t,e,n){return e in t?Un(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};var Wn=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Gn(n);"function"==typeof $n&&(r=r.concat($n(n).filter(function(t){return Ye(n,t).enumerable}))),r.forEach(function(e){Vn(t,e,n[e])})}return t},Bn=function(t,e){if(!g(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t},Jn=T.f,Kn=Qe.fastKey,Yn=b?"_s":"size",Qn=function(t,e){var n,r=Kn(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n},Xn={getConstructor:function(t,e,n,r){var o=t(function(t,i){Dt(t,o,e,"_i"),t._t=e,t._i=ut(null),t._f=void 0,t._l=void 0,t[Yn]=0,null!=i&&Ut(i,n,t[r],t)});return ve(o.prototype,{clear:function(){for(var t=Bn(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[Yn]=0},delete:function(t){var n=Bn(this,e),r=Qn(n,t);if(r){var o=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=o),o&&(o.p=i),n._f==r&&(n._f=o),n._l==r&&(n._l=i),n[Yn]--}return!!r},forEach:function(t){Bn(this,e);for(var n,r=y(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!Qn(Bn(this,e),t)}}),b&&Jn(o.prototype,"size",{get:function(){return Bn(this,e)[Yn]}}),o},def:function(t,e,n){var r,o,i=Qn(t,e);return i?i.v=n:(t._l=i={i:o=Kn(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=i),r&&(r.n=i),t[Yn]++,"F"!==o&&(t._i[o]=i)),t},getEntry:Qn,setStrong:function(t,e,n){St(t,e,function(t,n){this._t=Bn(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?Pt(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,Pt(1))},n?"entries":"values",!n,!0),ye(e)}},Zn=at("species"),tr=function(t,e){return new(function(t){var e;return nn(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!nn(e.prototype)||(e=void 0),g(e)&&null===(e=e[Zn])&&(e=void 0)),void 0===e?Array:e}(t))(e)},er=T.f,nr=function(t,e){var n=1==t,r=2==t,o=3==t,i=4==t,s=6==t,c=5==t||s,u=e||tr;return function(e,a,f){for(var l,h,p=yt(e),v=I(p),d=y(a,f,3),g=G(v.length),_=0,m=n?u(e,g):r?u(e,0):void 0;g>_;_++)if((c||_ in v)&&(h=d(l=v[_],_,p),t))if(n)m[_]=h;else if(h)switch(t){case 3:return!0;case 5:return l;case 6:return _;case 2:m.push(l)}else if(i)return!1;return s?-1:o||i?i:m}}(0);!function(t,e,n,r,o,i){var s=p[t],c=s,u=o?"set":"add",a=c&&c.prototype,f={};b&&"function"==typeof c&&(i||a.forEach&&!m(function(){(new c).entries().next()}))?(c=e(function(e,n){Dt(e,c,t,"_c"),e._c=new s,null!=n&&Ut(n,o,e[u],e)}),nr("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in a&&(!i||"clear"!=t)&&x(c.prototype,t,function(n,r){if(Dt(this,c,t),!e&&i&&!g(n))return"get"==t&&void 0;var o=this._c[t](0===n?0:n,r);return e?this:o})}),i||er(c.prototype,"size",{get:function(){return this._c.size}})):(c=r.getConstructor(e,t,o,u),ve(c.prototype,n),Qe.NEED=!0),ht(c,t),f[t]=c,L(L.G+L.W+L.F,f),i||r.setStrong(c,t,o)}("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=Xn.getEntry(Bn(this,"Map"),t);return e&&e.v},set:function(t,e){return Xn.def(Bn(this,"Map"),0===t?0:t,e)}},Xn,!0);L(L.P+L.R,"Map",{toJSON:function(t){return function(){if(Nt(this)!=t)throw TypeError(t+"#toJSON isn't generic");return function(t,e){var n=[];return Ut(t,!1,n.push,n,e),n}(this)}}("Map")});var rr;rr="Map",L(L.S,rr,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}});!function(t){L(L.S,t,{from:function(t){var e,n,r,o,i=arguments[1];return d(this),(e=void 0!==i)&&d(i),null==t?new this:(n=[],e?(r=0,o=y(i,arguments[2],2),Ut(t,!1,function(t){n.push(o(t,r++))})):Ut(t,!1,n.push,n),new this(n))}})}("Map");var or=v.Map,ir=Object.assign,sr=!ir||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=ir({},t)[n]||Object.keys(ir({},e)).join("")!=r})?function(t,e){for(var n=yt(t),r=arguments.length,o=1,i=en.f,s=Ue.f;r>o;)for(var c,u=I(arguments[o++]),a=i?et(u).concat(i(u)):et(u),f=a.length,l=0;f>l;)c=a[l++],b&&!s.call(u,c)||(n[c]=u[c]);return n}:ir;L(L.S+L.F,"Object",{assign:sr});var cr=v.Object.assign,ur="object"==typeof global&&global&&global.Object===Object&&global,ar="object"==typeof self&&self&&self.Object===Object&&self,fr=ur||ar||Function("return this")(),lr=fr.Symbol,hr=Object.prototype,pr=hr.hasOwnProperty,vr=hr.toString,dr=lr?lr.toStringTag:void 0;var yr=Object.prototype.toString;var gr="[object Null]",_r="[object Undefined]",mr=lr?lr.toStringTag:void 0;function br(t){return null==t?void 0===t?_r:gr:mr&&mr in Object(t)?function(t){var e=pr.call(t,dr),n=t[dr];try{t[dr]=void 0;var r=!0}catch(t){}var o=vr.call(t);return r&&(e?t[dr]=n:delete t[dr]),o}(t):function(t){return yr.call(t)}(t)}function wr(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var Or="[object AsyncFunction]",Sr="[object Function]",jr="[object GeneratorFunction]",Pr="[object Proxy]";var Er,Tr=fr["__core-js_shared__"],kr=(Er=/[^.]+$/.exec(Tr&&Tr.keys&&Tr.keys.IE_PROTO||""))?"Symbol(src)_1."+Er:"";var xr=Function.prototype.toString;var Mr=/^\[object .+?Constructor\]$/,Rr=Function.prototype,Fr=Object.prototype,Ar=Rr.toString,Lr=Fr.hasOwnProperty,Cr=RegExp("^"+Ar.call(Lr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function zr(t){return!(!wr(t)||(e=t,kr&&kr in e))&&(function(t){if(!wr(t))return!1;var e=br(t);return e==Sr||e==jr||e==Or||e==Pr}(t)?Cr:Mr).test(function(t){if(null!=t){try{return xr.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function Nr(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return zr(n)?n:void 0}var Dr=Nr(Object,"create");var Ir="__lodash_hash_undefined__",qr=Object.prototype.hasOwnProperty;var $r=Object.prototype.hasOwnProperty;var Gr="__lodash_hash_undefined__";function Hr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ur(t,e){for(var n,r,o=t.length;o--;)if((n=t[o][0])===(r=e)||n!=n&&r!=r)return o;return-1}Hr.prototype.clear=function(){this.__data__=Dr?Dr(null):{},this.size=0},Hr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Hr.prototype.get=function(t){var e=this.__data__;if(Dr){var n=e[t];return n===Ir?void 0:n}return qr.call(e,t)?e[t]:void 0},Hr.prototype.has=function(t){var e=this.__data__;return Dr?void 0!==e[t]:$r.call(e,t)},Hr.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Dr&&void 0===e?Gr:e,this};var Vr=Array.prototype.splice;function Wr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Wr.prototype.clear=function(){this.__data__=[],this.size=0},Wr.prototype.delete=function(t){var e=this.__data__,n=Ur(e,t);return!(n<0||(n==e.length-1?e.pop():Vr.call(e,n,1),--this.size,0))},Wr.prototype.get=function(t){var e=this.__data__,n=Ur(e,t);return n<0?void 0:e[n][1]},Wr.prototype.has=function(t){return Ur(this.__data__,t)>-1},Wr.prototype.set=function(t,e){var n=this.__data__,r=Ur(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var Br=Nr(fr,"Map");function Jr(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function Kr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Kr.prototype.clear=function(){this.size=0,this.__data__={hash:new Hr,map:new(Br||Wr),string:new Hr}},Kr.prototype.delete=function(t){var e=Jr(this,t).delete(t);return this.size-=e?1:0,e},Kr.prototype.get=function(t){return Jr(this,t).get(t)},Kr.prototype.has=function(t){return Jr(this,t).has(t)},Kr.prototype.set=function(t,e){var n=Jr(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var Yr="__lodash_hash_undefined__";function Qr(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Kr;++e<n;)this.add(t[e])}function Xr(t){return t!=t}function Zr(t,e){return!!(null==t?0:t.length)&&function(t,e,n){return e==e?function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,Xr,n)}(t,e,0)>-1}function to(t,e,n){for(var r=-1,o=null==t?0:t.length;++r<o;)if(n(e,t[r]))return!0;return!1}function eo(t,e){return t.has(e)}Qr.prototype.add=Qr.prototype.push=function(t){return this.__data__.set(t,Yr),this},Qr.prototype.has=function(t){return this.__data__.has(t)};var no=Nr(fr,"Set");function ro(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var oo=no&&1/ro(new no([,-0]))[1]==1/0?function(t){return new no(t)}:function(){},io=200;function so(t,e){return e="function"==typeof e?e:void 0,t&&t.length?function(t,e,n){var r=-1,o=Zr,i=t.length,s=!0,c=[],u=c;if(n)s=!1,o=to;else if(i>=io){var a=e?null:oo(t);if(a)return ro(a);s=!1,o=eo,u=new Qr}else u=e?[]:c;t:for(;++r<i;){var f=t[r],l=e?e(f):f;if(f=n||0!==f?f:0,s&&l==l){for(var h=u.length;h--;)if(u[h]===l)continue t;e&&u.push(l),c.push(f)}else o(u,l,n)||(u!==c&&u.push(l),c.push(f))}return c}(t,void 0,e):[]}const co=global.navigator&&global.navigator.userAgent?o.getParser(global.navigator.userAgent).getBrowser():null,uo=co&&co.name&&co.version?{name:co.name,version:co.version}:null;class ao{constructor(t={}){cr(this,{version:"1.2",entries:[],pages:[]},t),!this.browser&&uo&&(this.browser=uo)}addEntries(t=[]){this.entries=so([...t,...this.entries],(t,e)=>t._id===e._id&&t._order===e._order)}sortEntries(){this.entries=this.entries.sort((t,e)=>new Date(t.startedDateTime)-new Date(e.startedDateTime))}}class fo{constructor(t={}){this.log=new ao(t.log)}}var lo="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029\ufeff",ho="["+lo+"]",po=RegExp("^"+ho+ho+"*"),vo=RegExp(ho+ho+"*$"),yo=function(t,e,n){var r={},o=m(function(){return!!lo[t]()||"âÂ"!="âÂ"[t]()}),i=r[t]=o?e(go):lo[t];n&&(r[n]=i),L(L.P+L.F*o,"String",r)},go=yo.trim=function(t,e){return t=String(l(t)),1&e&&(t=t.replace(po,"")),2&e&&(t=t.replace(vo,"")),t},_o=yo,mo=p.parseInt,bo=_o.trim,wo=/^[-+]?0[xX]/,Oo=8!==mo(lo+"08")||22!==mo(lo+"0x16")?function(t,e){var n=bo(String(t),3);return mo(n,e>>>0||(wo.test(n)?16:10))}:mo;L(L.G+L.F*(parseInt!=Oo),{parseInt:Oo});var So=v.parseInt;const{keys:jo}=Object,{isArray:Po}=Array;function Eo(t){return jo(t||{}).reduce((e,n)=>{const r=t[n];return Po(r)?e.push(...r.map(t=>({name:n,value:t,_fromType:"array"}))):e.push({name:n,value:r}),e},[])}const{isArray:To}=Array;function ko(t,e){const n=t.getHeader(e);return To(n)?n.length>0?n[0]:"":n}class xo{constructor(t){this.httpVersion="HTTP/1.1",this.url=t.absoluteUrl,this.method=t.method,this.headers=Eo(t.headers),this.headersSize=function(t){const e=[],n=[];t.headers.forEach(({name:t,value:r})=>{e.push(t),n.push(r)});const r=t.method+t.url+e.join()+n.join();return i(r)+2*e.length+2+12+2}(this),this.queryString=Eo(t.query),this.cookies=s.parse(t.getHeader("Set-Cookie")),t.body&&(this.postData={mimeType:ko(t,"Content-Type")||"text/plain",params:[]},"string"==typeof t.body&&(this.postData.text=t.body));const e=ko(t,"Content-Length");this.bodySize=e?So(e,10):this.postData&&this.postData.text?i(this.postData.text):0}}class Mo{constructor(t){this.httpVersion="HTTP/1.1",this.status=t.statusCode,this.statusText=t.statusText,this.headers=Eo(t.headers),this.headersSize=function(t){const e=[],n=[];t.headers.forEach(({name:t,value:r})=>{e.push(t),n.push(r)});const r=e.join()+n.join();return i(r)+2*e.length+2+2}(this),this.cookies=s.parse(t.getHeader("Set-Cookie")),this.redirectURL=ko(t,"Location")||"",this.content={mimeType:ko(t,"Content-Type")||"text/plain"},t.body&&"string"==typeof t.body&&(this.content.text=t.body,t.isBinary&&(this.content._isBinary=!0));const e=ko(t,"Content-Length");this.content.size=e?So(e,10):this.content.text?i(this.content.text):0,this.bodySize=this.content.size}}const{keys:Ro}=Object;class Fo{constructor(t){this._id=t.id,this._order=t.order,this.startedDateTime=t.timestamp,this.request=new xo(t),this.response=new Mo(t.response),this.cache={},this.timings={blocked:-1,dns:-1,connect:-1,send:0,wait:t.responseTime,receive:0,ssl:-1},this.time=function(t={}){return Ro(t).reduce((e,n)=>t[n]>0?e+=t[n]:e,0)}(this.timings)}}const Ao="Polly.JS";export default class{constructor(t){this.polly=t,this.pending=new or,this._cache=new or}static get type(){return"persister"}static get id(){e("Must override the static `id` getter.")}get defaultOptions(){return{}}get options(){return Wn({},this.defaultOptions||{},(this.polly.config.persisterOptions||{})[n(this.constructor)]||{})}get hasPending(){return this.pending.size>0}async persist(){if(!this.hasPending)return;const t=[],e={name:Ao,version:this.polly.constructor.VERSION,comment:`${this.constructor.type}:${n(this.constructor)}`};for(const[n,{name:r,requests:o}]of this.pending){const i=[],s=await this.find(n);let c;c=new fo(s||{log:{creator:e,_recordingName:r}});for(const t of o){const e=new Fo(t);this.assert(`Cannot persist response for [${e.request.method}] ${e.request.url} because the status code was ${e.response.status} and \`recordFailedRequests\` is \`false\``,t.response.ok||t.config.recordFailedRequests),await t._emit("beforePersist",e),i.push(e)}c.log.addEntries(i),this.polly.config.persisterOptions.disableSortingHarEntries||c.log.sortEntries(),this.polly.config.persisterOptions.keepUnusedRequests||this._removeUnusedEntries(n,c),t.push(this.save(n,c))}await He.all(t),this.pending.clear()}recordRequest(t){this.assert("You must pass a PollyRequest to 'recordRequest'.",t),this.assert("Cannot save a request with no response.",t.didRespond);const{recordingId:e,recordingName:n}=t;this.pending.has(e)||this.pending.set(e,{name:n,requests:[]}),this.pending.get(e).requests.push(t)}async find(t){const{_cache:e}=this;if(!e.has(t)){const n=async()=>{const n=await this.findRecording(t);return n?(this.assert(`Recording with id '${t}' is invalid. Please delete the recording so a new one can be created.`,n.log&&n.log.creator.name===Ao),n):(e.delete(t),null)};e.set(t,n())}return e.get(t)}async save(t){await this.saveRecording(...arguments),this._cache.delete(t)}async delete(t){await this.deleteRecording(...arguments),this._cache.delete(t)}async findEntry(t){const{id:e,order:n,recordingId:r}=t,o=await this.find(r);return o&&o.log.entries.find(t=>t._id===e&&t._order===n)||null}stringify(){return t(...arguments)}assert(t,...r){e(`[${this.constructor.type}:${n(this.constructor)}] ${t}`,...r)}_removeUnusedEntries(t,e){const n=this.polly._requests.filter(e=>e.recordingId===t&&(e.action===r.RECORD||e.action===r.REPLAY));e.log.entries=e.log.entries.filter(t=>n.find(e=>t._id===e.id&&t._order===e.order))}findRecording(){this.assert("Must implement the `findRecording` hook.")}saveRecording(){this.assert("Must implement the `saveRecording` hook.")}deleteRecording(){this.assert("Must implement the `deleteRecording` hook.")}}
//# sourceMappingURL=pollyjs-persister.min.js.map
